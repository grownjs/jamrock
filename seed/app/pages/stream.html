<script>
  import { onRelease } from 'jamrock/hooks';
  import { tick, reply } from 'jamrock/conn';

  let max = 10;
  async function* local() {
    yield max;
    while (true) {
      if (max <= 0) break;
      yield Math.random();
      await tick(200);
    }
  }

  const t = setInterval(() => {
    if (max-- <= 0) {
      clearInterval(t);
      return;
    }
    reply({ local: max });
  }, 1000);

  onRelease(() => clearInterval(t));
</script>

<ol style:paddingLeft="2em" reversed>
  <fragment id="local" mode="prepend">
    {#each local as item}
      <li>{@debug item}</li>
    {/each}
  </fragment>
</ol>
